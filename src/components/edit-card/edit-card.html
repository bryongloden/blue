<link rel='import' href='../../../bower_components/polymer/polymer.html'>
<link rel='import' href='../../../bower_components/paper-card/paper-card.html'>
<link rel='import' href='../../../bower_components/paper-input/paper-input.html'>
<link rel='import' href='../../../bower_components/paper-dropdown-menu/paper-dropdown-menu.html'>
<link rel='import' href='../../../bower_components/paper-listbox/paper-listbox.html'>
<link rel='import' href='../../../bower_components/paper-item/paper-item.html'>
<link rel='import' href='../../../bower_components/paper-button/paper-button.html'>

<link rel='import' href='../status-icon-ping/status-icon-ping.html'>
<link rel='import' href='../status-icon-ssh/status-icon-ssh.html'>

<dom-module id='edit-card'>
  <template>
    <style>
      :host {
        width: 300px;
        --paper-input-container-underline: {
          background: #aaa;
        }
      }

      paper-card {
        width: 100%;
      }

      header {
        padding: 25px 45px 0;
        height: 220px;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      img {
        max-width: 100%;
      }

      img.macbook {
        max-width: 80%;
      }

      img.imac {
        max-width: 90%;
      }

      paper-dropdown-menu {
        width: 100%;
      }

      paper-button {
        --paper-button-ink-color: var(--paper-indigo-100);
      }

      paper-button:hover {
        color: var(--paper-pink-a200);
      }

      footer {
        border: 0;
        text-align: center;
      }
    </style>

    <paper-card>
      <header>
        <img src='{{image}}' class$='{{type}}'/>
      </header>

      <div class='card-content'>
        <!-- TYPE -->
        <paper-dropdown-menu label='type' on-iron-select='changeType' noink>
          <paper-listbox class='dropdown-content' selected='{{selectedTypeIndex(typeInfo, type)}}'>
            <paper-item data-key='macbook'>Macbook</paper-item>
            <paper-item data-key='imac'>iMac</paper-item>
            <paper-item data-key='macpro'>Mac Pro</paper-item>
            <paper-item data-key='macmini'>Mac Mini</paper-item>
          </paper-listbox>
        </paper-dropdown-menu>

        <!-- ADDRESS -->
        <paper-input label='address' value='{{address}}' on-change='changeAddress' required auto-validate>
          <status-icon-ping show-status-check suffix></status-icon-ping>
        </paper-input>

        <!-- USERNAME -->
        <paper-input label='username' value='{{username}}' on-change='changeUsername' required auto-validate>
          <status-icon-ssh address='{{address}}' show-status-check suffix></status-icon-ssh>
        </paper-input>

        <!-- NICKNAME -->
        <paper-input label='nickname' value='{{nickname}}' on-change='changeNickname'></paper-input>
      </div>

      <footer class='card-actions'>
        <paper-button>Save</paper-button>
      </footer>
    </paper-card>
  </template>

  <script>
    Polymer({
      is: 'edit-card',

      // PROPERTIES
      properties: {
        id: {
          type: Number,
          readOnly: true,
          value: -1
        },
        type: {
          type: 'String',
          value: 'macbook'
        },
        address: {
          type: 'String',
          notify: true
        },
        username: {
          type: 'String',
          notify: true
        },
        nickname: {
          type: 'String',
          notify: true
        },
        image: {
          type: 'String',
          readOnly: true,
          computed: 'selectedTypeImage(typeInfo, type)'
        },
        typeInfo: {
          type: Object,
          value: {
            'macbook': {index: 0, path: 'apple/macbook-original.png'},
            'imac': {index: 1, path: 'apple/imac-original.png'},
            'macpro': {index: 2, path: 'apple/macpro-small.png'},
            'macmini': {index: 3, path: 'apple/macmini-medium.png'}
          }
        }
      },

      // COMPUTED BINDINGS
      selectedTypeIndex: function(typeInfo, type) {
        return typeInfo[type].index;
      },

      selectedTypeImage: function(typeInfo, type) {
        return this.resolveUrl(typeInfo[type].path);
      },

      // INPUT HANDLERS
      changeType: function(e, detail) {
        this.type = detail.item.dataset.key;
        this.saveChanges();
      },

      changeAddress: function(e) {
        const S = require('string');
        this.address = e.target.value;

        // prefill nickname to match the address
        if (!this.nickname) {
          this.nickname = S(this.address).chompRight('.local');
        }

        this.saveChanges();
      },

      changeUsername: function(e) {
        this.username = e.target.value;
        this.saveChanges();
      },

      changeNickname: function(e) {
        this.nickname = e.target.value;
        this.saveChanges();
      },

      // SAVE HANDLERS
      saveChanges: function() {
        if (this.id !== -1) {
          console.log('saving changes to disk...');
        } else {
          console.log('not saving changes disk yet.');
        }
      },

      save: function() {
        if (this.id === -1) {
          console.info('creating new card...');

          this.saveChanges();
        }
      }
    });
  </script>
</dom-module>
